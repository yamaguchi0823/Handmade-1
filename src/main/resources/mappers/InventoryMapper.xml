<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.app.mapper.InventoryMapper">

<select id="searchInventory" resultType="com.example.app.dto.InventoryView">
	SELECT 
        i.id AS itemId,
        i.name AS itemName,
        v.id AS variantId,
        v.color,
        v.size,
        v.category,
        v.quantity_per_set AS quantityPerSet,
        v.sku_code AS skuCode,
        v.stock,
        v.price,
        CONCAT('/uploads/', v.image_filename) AS imagePath       
    FROM items i
    INNER JOIN item_variants v ON i.id = v.item_id
    WHERE 1 = 1
        <if test="keyword != null and keyword != ''">
            AND i.name LIKE CONCAT('%', #{keyword}, '%')
        </if>
        <if test="sku != null and sku != ''">
            AND v.sku_code LIKE CONCAT('%', #{sku}, '%')
        </if>
        <if test="color != null and color != ''">
            AND v.color = #{color}
        </if>
        <if test="size != null and size != ''">
            AND v.size = #{size}
        </if>
        <if test="stockFilter == 'zero'">
            AND v.stock = 0
        </if>
        <if test="stockFilter == 'low'">
            AND v.stock BETWEEN 1 AND 5
        </if>
        <if test="stockFilter == 'enough'">
            AND v.stock >= 6
        </if>
    ORDER BY i.id, v.id
	
	</select>
	
	<!-- 色一覧 -->
	<select id="findDistinctColors" resultType="string">
	    SELECT DISTINCT color FROM item_variants ORDER BY color
	</select>
	
	<!-- サイズ一覧 -->
	<select id="findDistinctSizes" resultType="string">
	    SELECT DISTINCT size FROM item_variants ORDER BY size
	</select>

</mapper>